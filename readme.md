
# idolly-styler
Easily make unique style images using exist photo!

# idolly-agent

## üé§ What is Idolly Agent Server?

The Idolly Agent Server empowers you to effortlessly create and manage your personalized AI Idols. This server transforms your creative ideas into engaging AI-driven content, enabling dynamic interactions and automated postings to build your idol's influence.

This repository explains the server's functionality, with a focus on how it uses technologies like LangGraph for orchestration.

## üöß How It Works

The server operates through the following user-centered flow. The "Idol Brain" is the core orchestrator, largely powered by LangGraph workflows.

```
User (You)
 ‚îú‚îÄ‚îÄ Request to Create Idol
 ‚îú‚îÄ‚îÄ Request to Create Posts (Manual or Automatic via SQS)
 ‚îî‚îÄ‚îÄ Request for Profile Images
         ‚îÇ
         ‚ñº
Idolly Agent Server
 ‚îú‚îÄ‚îÄ Idol Brain (Orchestrator - LangGraph based)
 ‚îÇ   ‚îú‚îÄ‚îÄ Idol Creation Workflow (Generates Persona & Profile Pic)
 ‚îÇ   ‚îú‚îÄ‚îÄ Post Creation Workflow (Automates Content & Image Generation)
 ‚îÇ   ‚îî‚îÄ‚îÄ Manages Personalized Interactions (via Persona)
 ‚îÇ
 ‚îú‚îÄ‚îÄ Image Generation Service (External)
 ‚îÇ
 ‚îî‚îÄ‚îÄ Automated Posting (SQS Worker -> Post Agent)
     ‚îî‚îÄ‚îÄ Triggers Post Creation Workflow for automated SNS content
```

## ‚ú® Key Features with Examples

### 1Ô∏è‚É£ Create Your Idol

Generate a unique AI Idol based on your provided information.

**API Request Example (Pseudo-code):**
```
user_input = {
    name: "Sarah",
    age: 22,
    gender: "female",
    personality: "bright and energetic",
    specialty: ["dancing", "singing"],
    background: "Passionate dancer since childhood",
    // ... other fields like ethnicity, hair_style, fashion_style
}

idol = create_idol(user_input) // POST /v1/idols

response = {
    bio: idol.bio,  // Automatically generated bio
    profile_image: idol.profile_image_base64  // Generated profile image
}
```

**ü§ñ Behind the Scenes: Idol Creation Workflow (`llm/workflows/idol_creation_graph.py`)**

This feature is powered by a LangGraph `StateGraph`.
*   **State (`State` TypedDict):** Manages `idol_info`, `bio`, and `profile_pic_base64`.
*   **Nodes:**
    *   `generate_bio_node`: An LLM takes the `idol_info` and crafts a concise bio reflecting the idol's persona.
    *   `generate_image_node`:
        1.  Another LLM call generates a detailed image prompt based on the idol's appearance attributes (`ethnicity`, `hair_style`, etc.).
        2.  The `generate_image` tool is then called with this prompt to produce the profile picture.
*   **Flow:** `START` ‚Üí `generate_bio_node` ‚Üí `generate_image_node` ‚Üí `END`.
*   **Output:** The generated `bio` and `profile_pic_base64` are returned.

### 2Ô∏è‚É£ Manual Post Creation

Create tailored posts with custom images generated by AI based on your specified concept and the idol's persona.

**API Request Example (Pseudo-code):**
```
manual_post_request = {
    idol_id: "idol456",
    post_content: "Had so much fun at practice today!",
    image_prompt: "Idol practicing dance moves", // User's initial idea for the image
    image_count: 2,
    profile_pic: ""
}

post = create_manual_post(manual_post_request) // POST /v1/posts/manual

response = {
    post_content: post.final_content,
    images: post.generated_images_base64, // List of {image, seed}
    final_image_prompt: post.image_prompt // The detailed prompt generated by the workflow
}
```

**ü§ñ Behind the Scenes: Post Creation Workflow (`llm/workflows/post_creation_graph.py`)**

This also uses a LangGraph `StateGraph`.
*   **State (`State` TypedDict):** Tracks `messages`, `content` (original post), `image_prompt` (user's initial), `image_count`, `final_content`, `final_image_prompt`, `images`, `profile_pic_url` (for ReActor/Face Transfer), and crucially, `idol_persona` (fetched from Milvus, containing details like appearance, fashion style, personality).
*   **Nodes:**
    *   `refine_content_node`: (Currently passes through original content) Intended to refine the post text to match the idol's voice.
    *   `generate_image_prompt_node`: This is a key step. An LLM combines:
        1.  The post's `content`.
        2.  The user's initial `image_prompt`.
        3.  The detailed `idol_persona` (e.g., "Name: Sarah, Gender: female, Hair Style: long brown, Fashion Style: casual, energetic").
        The LLM then generates a rich, descriptive prompt for the image generation tool, ensuring the image aligns with both the post and the idol's established look and feel.
    *   `generate_images_node`: Calls the `generate_image` tool with the `final_image_prompt` and `profile_pic_url` (if face transfer is enabled).
*   **Flow:** `START` ‚Üí `refine_content_node` ‚Üí `generate_image_prompt_node` ‚Üí `generate_images_node` ‚Üí `END`.
*   **Output:** The (potentially refined) `post_content`, a list of `images` (base64 + seed), and the `final_image_prompt` used.

### 3Ô∏è‚É£ Automatic Post Management

Enable AI to automatically create and post daily content matching your Idol's persona and style. Settings are configured via an API, and posts are generated by an SQS worker.

**API Request Example for Settings (Pseudo-code):**
```
auto_post_settings = {
    idol_id: "idol456",
    enable_auto_post: true,
    daily_post_limit: 3,
    auto_post_contents: ["energetic and cheerful daily life", "dance practice moments"] // Themes/ideas for auto-posts
}

update_auto_post_settings(auto_post_settings) // PUT /v1/post-agent/settings

response = {"detail": "Automatic posting settings updated!"}
```
**ü§ñ Behind the Scenes: Automated Posting (`workers/sqs_worker.py` & `services/auto_post_service.py`)**
*   An SQS message (containing `user_id`, `idol_id`, `post_id`) triggers the `PostSqsWorker`.
*   The worker calls `process_auto_post` in `auto_post_service.py`.
*   This service fetches the idol's persona and auto-post settings (like `auto_post_contents`) from Milvus.
*   It then **utilizes the same `PostCreationGraph`** as manual posting.
    *   The `content` for the post is derived (e.g., selected from `auto_post_contents` or generated by another LLM based on the idol's persona).
    *   The initial `image_prompt` is also generated based on the idol's persona and the chosen content theme.
*   The generated post and images are saved, and a callback is made to the User Server.

## üß† Idol Brain (Orchestrator) - Powered by LangGraph

The "Idol Brain" is the central intelligence of the Idolly Agent Server, orchestrating complex AI tasks using **LangGraph**. LangGraph allows us to define stateful, multi-step agentic workflows as graphs. The primary workflows are:

### 1. Idol Creation Workflow (`llm/workflows/idol_creation_graph.py`)
   This graph manages the creation of a new AI idol.
   - **Input:** User-provided idol characteristics (name, age, personality, appearance details, etc.).
   - **Key Nodes:**
     - `generate_bio_node`: An LLM crafts an engaging biography based on the input characteristics.
     - `generate_image_node`:
       1.  An LLM generates a descriptive image prompt focusing on a profile picture, using the idol's appearance details (ethnicity, hair style, color, fashion).
       2.  This prompt is then fed to the `generate_image` tool (interfacing with `IMAGE_SERVER_URL`) to create the idol's profile image.
   - **Output:** A structured response containing the generated `bio` and the `profile_pic_base64`.
   - **State Management:** The graph's state tracks `idol_info`, `bio`, and `profile_pic_base64` as they are processed.

### 2. Post Creation Workflow (`llm/workflows/post_creation_graph.py`)
   This graph handles the generation of social media posts, including text and images. It's used for both manual and automated posts.
   - **Input:**
     - For manual posts: Original post content, initial image prompt idea, image count, idol's profile picture URL (for potential face transfer).
     - For automatic posts: Themes/content ideas, idol's profile picture URL.
     - For both: The `idol_persona` is fetched from Milvus (containing rich details about the idol's appearance, style, personality).
   - **Key Nodes:**
     - `refine_content_node`: (Currently a pass-through) Designed to adjust the post text to better fit the idol's established voice and persona.
     - `generate_image_prompt_node`: A critical LLM-powered node. It synthesizes the post's textual content, any user-provided image ideas, and the comprehensive `idol_persona` to create a highly detailed and contextually relevant image prompt. This ensures images are not generic but are tailored to the specific idol and the message of the post.
     - `generate_images_node`: Invokes the `generate_image` tool using the refined prompt from the previous step.
   - **Output:** Finalized post content, a list of generated images (base64 encoded), and the final image prompt used.
   - **State Management:** The graph's state tracks all inputs, intermediate values like the `final_image_prompt`, and outputs like `images` and `final_content`.

### Other LLM Utilities (`services/chain_service.py`)
   Beyond the core LangGraph workflows, the server also provides an endpoint (`/v1/chains/process`) for more direct, single-purpose LLM calls, such as:
   - Generating detailed backstories (`BACK_STORY`).
   - Crafting image prompts based on simpler inputs (`IMAGE_PROMPT`).

### User Memory
- The idol's persona, created attributes, generated bio, and post history are stored in Milvus.
- This data, especially the `idol_persona`, is fed back into the LangGraph workflows (like `PostCreationGraph`) to ensure consistency and personalization in content generation.

### Role-play
- the `idol_persona` stored in Milvus (including background story, personality) forms the basis for enabling immersive role-play interactions.

## üîß Monitoring and Tracing
- The system is configured to use **LangSmith** (`LANGSMITH_TRACING = True`) for tracing the execution of Langchain and LangGraph components, which is invaluable for debugging and observing the LLM calls and data flow within the graphs.

## üöÄ What Experience Can Users Expect?

- Effortlessly create and customize your own AI Idol with rich personas and unique visuals.
- Conveniently manage daily posts, with options for both manual control and AI-driven automation that respects the idol's character.
- Enjoy personalized interactions and strengthen the bond between fans and idols, as content is generated with the idol's specific traits in mind.

## üîÆ Future Developments

The Idolly Agent Server plans to expand by:

- Automating video content creation.
- Enhancing role-play with diverse scenarios, potentially using more complex LangGraph agents.
- Adding personalized recommendation and analytics features.
- MCP implementation

## üìö Learn More

Visit [idolly.ai Official Website](https://idolly.ai).

